services:
  postgres:
    image: postgres:15
    container_name: hash-benchmark-db
    environment:
      POSTGRES_USER: benchmark
      POSTGRES_PASSWORD: benchmark123
      POSTGRES_DB: hash_test
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    command:
      - "postgres"
      - "-c"
      - "shared_buffers=512MB"
      - "-c"
      - "effective_cache_size=1GB"
      - "-c"
      - "maintenance_work_mem=256MB"
      - "-c"
      - "work_mem=64MB"
      - "-c"
      - "max_wal_size=4GB"
      - "-c"
      - "checkpoint_timeout=30min"
      - "-c"
      - "wal_buffers=64MB"
      - "-c"
      - "max_connections=100"
    shm_size: '512mb'
    deploy:
      resources:
        limits:
          memory: 4G

  opensearch:
    image: opensearchproject/opensearch:2.11.0
    container_name: hash-benchmark-opensearch
    environment:
      - discovery.type=single-node
      - bootstrap.memory_lock=true
      - "OPENSEARCH_JAVA_OPTS=-Xms2g -Xmx2g"
      - DISABLE_SECURITY_PLUGIN=true
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    ports:
      - "9200:9200"
    volumes:
      - opensearch_data:/usr/share/opensearch/data
    deploy:
      resources:
        limits:
          memory: 4G

volumes:
  postgres_data:
  opensearch_data:
